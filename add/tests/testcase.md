# 仕様

※単体テスト仕様と設計上の仕様を兼任するメモとする。

## テスト化しない仕様

- 送信機の機能は，ボタン読み込み（上下左右に対応する4つ）と送信（赤外線LEDのOUTPUT, 10個のLED全てで共通の信号を送信）とする。
- 受信機の機能は，受信，モータ制御（サーボモータは制御2つ分，直流モータ制御1つ）とする。
- GPIOのOUTPUTのON-OFF，toggleは，IDEが生成する，ドライバーに相当するマクロ関数を使用する。
- 直流モータの制御はトランジスタによる電気式スイッチへPWMで送ることとし，直流モータは電源から直接動力を得るとする。

## テスト化する仕様

### 送信機



#### LEDドライバ

- ~~LEDがON-OFFできる。~~
- ~~入力によりON, OFF, TOGGLEを操作できる。~~
- 複数のLEDを同時に操作できる。
- タイマ割り込み周期に合わせて信号のONOFFを更新する
- 信号列に合わせてLEDをON-OFFする。

#### 目標値の変更

- ~~スイッチ入力により目標値が上下する。~~
- ~~上下左右に対応するボタンの入力を，外部割込みとして認識する。~~
- ~~SW1, 2のボタン入力があると，~~
    - ~~1の場合，速度目標値が+1~~
    - ~~2の場合，速度目標値が-1~~
- ~~SW3, 4のボタン入力があると，~~
    - ~~3の場合，ピッチ目標値が+1~~
    - ~~4の場合，ピッチ目標値が-1~~
- ~~SW5, 6のボタン入力があると，~~
    - ~~5の場合，ヨー目標値が+1~~
    - ~~6の場合，ヨー目標値が-1~~
- ~~信号整形関数 SetOutPut関数は，内部状態変数SignalState, 入力配列g_SignalRowによって出力を変化させるとします。 SetOutPut関数の出力はint型です。~~
    - ~~SetOutput関数は，呼び出されるたびに，内部状態変数StateStepperを1カウントアップする。~~
    - ~~SetOutput関数は，内部状態変数StateStepper=1の時，1(True)を返す。~~
    - ~~SetOutput関数は，内部状態変数StateStepper=2の時，0(false)を返す。~~
    - ~~g_SignalRowのそれぞれの値の最小値は-8，最大値は8 。~~
    - ~~SetOutput関数は，g_SignalRow[0]を元にした信号整形をし，次にg_SignalRow[1]の信号整形をし，最後にg_SignalRow[2]の信号整形をする。~~
    - ~~g_SignalRow[*]の値が-8の時，内部状態変数StateStepper=3の時，1を返す。~~
    - ~~g_SignalRow[*]の値が8の時，内部状態変数StateStepper=3~18の間0を返し，StateStepper=9の時1を返す。~~
    - ~~g_SignalRow[*]の値が8の時，内部状態変数StateStepper=3~10の間0を返し，StateStepper=11の時1を返す。~~
    - ~~信号整形関数はクリア関数を持つ~~
- 速度目標，ピッチ目標，ヨー目標を元に，送信信号のOFF時間の長さを計算する。
    - 送信信号に対応した配列に，信号列を格納する。

#### 未完了

- LED 10個で同時に点灯することができる。
- 

- タイマ割り込み時間の100倍の時間を，基準周期とする。基準周期のONの時間とOFFの時間はそれぞれタイマ割り込みの4倍の時間とし，その後の信号が，モータ制御信号とする。
- モータ制御信号は，3種類のモータに対応する信号を重畳した信号を送信する。
- モータ制御信号は，1つめのON→OFFの後の時間の長さがch1の信号，2つめのON→OFFの後の時間の長さがch2の信号，3つめのON→OFFの後の時間の長さがch3の信号とする。4つ目のON→OFFは，ch3の信号の終了を識別するために使用する。それぞれ，ONの時間はタイマ割り込み時間の2倍とする。

### 受信機のみ


#### 完了済み

#### 未完了

- 周期OOでセンサ値を読み込む(タイマ割り込み)。
- 過去10回のセンサ値を，配列として先入先出で保持する。
- モータ制御信号を解析し，モータ設定値変数を更新する。
- モータ設定値変数を元に，常にモータに指令信号を送り続ける。（ポーリング処理）
- モータのうち，サーボモータはPWM制御で角度を制御することとする。
- モータのうち，直流モータはPWM制御で電圧を制御することとする。


